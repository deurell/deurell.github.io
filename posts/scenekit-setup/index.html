<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Setting up ShaderModifiers in SceneKit | Deurell Labs</title>
<meta name="keywords" content="SceneKit, Shaders">
<meta name="description" content="I &lt;3 the Metal shader debugger in XCode. It&rsquo;s one of those things that feels like they&rsquo;ve been sent from the future. I&rsquo;ve been doing shaders in OpenGL for years and years. The last five years I&rsquo;ve been helping a nice Swedish game company to code casual games with a lot of Candy. And Crushes. More than once I&rsquo;ve realized that the demos and shaders I did for fun in my teens are the very things that&rsquo;s putting food on the table for my kids over 100 years later.">
<meta name="author" content="">
<link rel="canonical" href="https://deurell.github.io/posts/scenekit-setup/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css" integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://deurell.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://deurell.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://deurell.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://deurell.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://deurell.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Setting up ShaderModifiers in SceneKit" />
<meta property="og:description" content="I &lt;3 the Metal shader debugger in XCode. It&rsquo;s one of those things that feels like they&rsquo;ve been sent from the future. I&rsquo;ve been doing shaders in OpenGL for years and years. The last five years I&rsquo;ve been helping a nice Swedish game company to code casual games with a lot of Candy. And Crushes. More than once I&rsquo;ve realized that the demos and shaders I did for fun in my teens are the very things that&rsquo;s putting food on the table for my kids over 100 years later." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deurell.github.io/posts/scenekit-setup/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-12T18:45:31+02:00" />
<meta property="article:modified_time" content="2019-04-12T18:45:31+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Setting up ShaderModifiers in SceneKit"/>
<meta name="twitter:description" content="I &lt;3 the Metal shader debugger in XCode. It&rsquo;s one of those things that feels like they&rsquo;ve been sent from the future. I&rsquo;ve been doing shaders in OpenGL for years and years. The last five years I&rsquo;ve been helping a nice Swedish game company to code casual games with a lot of Candy. And Crushes. More than once I&rsquo;ve realized that the demos and shaders I did for fun in my teens are the very things that&rsquo;s putting food on the table for my kids over 100 years later."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://deurell.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Setting up ShaderModifiers in SceneKit",
      "item": "https://deurell.github.io/posts/scenekit-setup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Setting up ShaderModifiers in SceneKit",
  "name": "Setting up ShaderModifiers in SceneKit",
  "description": "I \u0026lt;3 the Metal shader debugger in XCode. It\u0026rsquo;s one of those things that feels like they\u0026rsquo;ve been sent from the future. I\u0026rsquo;ve been doing shaders in OpenGL for years and years. The last five years I\u0026rsquo;ve been helping a nice Swedish game company to code casual games with a lot of Candy. And Crushes. More than once I\u0026rsquo;ve realized that the demos and shaders I did for fun in my teens are the very things that\u0026rsquo;s putting food on the table for my kids over 100 years later.",
  "keywords": [
    "SceneKit", "Shaders"
  ],
  "articleBody": "I \u003c3 the Metal shader debugger in XCode. It’s one of those things that feels like they’ve been sent from the future. I’ve been doing shaders in OpenGL for years and years. The last five years I’ve been helping a nice Swedish game company to code casual games with a lot of Candy. And Crushes. More than once I’ve realized that the demos and shaders I did for fun in my teens are the very things that’s putting food on the table for my kids over 100 years later. Well.. Almost 100 years later.\nAfter last years WWDC I downloaded the new XCode with the Metal debugger and. I was completely blown away! Writing shaders in Metal is like writing ordinary C++ 14 at work but without those pesky templates. Just the way I like C++! And the shader debugger. The shader debugger is better the my standard C++ debugger at work!\nI did a lot of face tracking app sessions with AR kit. Pretty much like this:\nI wanted to have a quick shader lab environment without an iPhone and AR stuff but still work on the face tracking SceneKit shaders on the commute to work where I only have my laptop. The quickest setup was to do a simple plane geometry in SceneKit and hook up ShaderModifiers.\nShaderModifiers can be both vertex and fragment modifiers and are injected in to the standard SceneKit shader setup using pragmas. Pretty convenient, I use it all the time. So how do we set it up?\nCreate a standard MacOS app with a view and a ViewController, set up a SceneKit scene and hook up a shader modifier this way:\nimport Cocoa import SceneKit class ViewController: NSViewController { var scnView: SCNView! var scnScene: SCNScene! var cameraNode: SCNNode! override func viewDidLoad() { super.viewDidLoad() scnView = self.view as? SCNView scnView.showsStatistics = false scnView.allowsCameraControl = true scnView.autoenablesDefaultLighting = false scnScene = SCNScene() scnScene.background.contents = NSColor.gray scnView.scene = scnScene cameraNode = SCNNode() cameraNode.camera = SCNCamera() cameraNode.position = SCNVector3(x:0, y:0, z:12) scnScene.rootNode.addChildNode(cameraNode) let plane = SCNPlane(width: 20, height: 10) guard let shaderURL = Bundle.main.url(forResource: \"frag\", withExtension: \"shader\"), let modifier = try? String(contentsOf: shaderURL) else { fatalError(\"Can't load shader from bundle.\") } plane.shaderModifiers = [.fragment: modifier] let node = SCNNode(geometry: plane) plane.firstMaterial?.diffuse.contents = NSImage(named: \"skull\") plane.firstMaterial?.diffuse.wrapS = SCNWrapMode.repeat; plane.firstMaterial?.diffuse.wrapT = SCNWrapMode.repeat; scnScene.rootNode.addChildNode(node) scnView.isPlaying = true } } Add a texture to the bundle, in this case it’s called skulls and create a frag.shader file with the shader modifier.\n#pragma transparent #pragma body float mpi = 3.1415926535897932384626433832795; // scenekit stashes time in scn_frame float iTime = scn_frame.time; // grab uv coords from our material float2 uv = _surface.diffuseTexcoord; // we want a coords from -1 to 1 instead of standard uv coords (0-1) float2 p = -1.0+2.0*uv; // length and angle from center for fancy polar coord dist. float r = length(p); float a = atan(p.y / p.x); //classic demo fx float2 uvmod = float2(p.x/abs(p.y), 1/abs(p.y)); // uv scroll it with time uvmod += iTime; // get the diffuse sampler and get col at distorted uv coords float4 texcol = u_diffuseTexture.sample(u_diffuseTextureSampler, uvmod); _output.color.rgba = texcol; The sample is a classic memory from my boy room. A nice u=x/abs(y) v=1/abs(y), but in 2019 I don’t need LUTs. Nice.\nThe full source code can be found here https://github.com/deurell/ShaderModifierLab\n\u003c3\n",
  "wordCount" : "548",
  "inLanguage": "en",
  "datePublished": "2019-04-12T18:45:31+02:00",
  "dateModified": "2019-04-12T18:45:31+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://deurell.github.io/posts/scenekit-setup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Deurell Labs",
    "logo": {
      "@type": "ImageObject",
      "url": "https://deurell.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://deurell.github.io" accesskey="h" title="Deurell Labs (Alt + H)">Deurell Labs</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Setting up ShaderModifiers in SceneKit
    </h1>
    <div class="post-meta"><span title='2019-04-12 18:45:31 +0200 CEST'>April 12, 2019</span>

</div>
  </header> 
  <div class="post-content"><p>I &lt;3 the Metal shader debugger in XCode. It&rsquo;s one of those things that feels like they&rsquo;ve been sent from the future. I&rsquo;ve been doing shaders in OpenGL for years and years. The last five years I&rsquo;ve been helping a nice Swedish game company to code casual games with a lot of Candy. And Crushes. More than once I&rsquo;ve realized that the demos and shaders I did for fun in my teens are the very things that&rsquo;s putting food on the table for my kids over 100 years later. Well.. Almost 100 years later.</p>
<p>After last years WWDC I downloaded the new XCode with the Metal debugger and. I was completely blown away! Writing shaders in Metal is like writing ordinary C++ 14 at work but without those pesky templates. Just the way I like C++! And the shader debugger. The shader debugger is better the my standard C++ debugger at work!</p>
<p>I did a lot of face tracking app sessions with AR kit. Pretty much like this:</p>
<p><img loading="lazy" src="/face.gif" alt="face tracking"  />
</p>
<p>I wanted to have a quick shader lab environment without an iPhone and AR stuff but still work on the face tracking SceneKit shaders on the commute to work where I only have my laptop. The quickest setup was to do a simple plane geometry in SceneKit and hook up ShaderModifiers.</p>
<p>ShaderModifiers can be both vertex and fragment modifiers and are injected in to the standard SceneKit shader setup using pragmas. Pretty convenient, I use it all the time. So how do we set it up?</p>
<p>Create a standard MacOS app with a view and a ViewController, set up a SceneKit scene and hook up a shader modifier this way:</p>
<pre tabindex="0"><code>import Cocoa
import SceneKit

class ViewController: NSViewController {
    
    var scnView: SCNView!
    var scnScene: SCNScene!
    var cameraNode: SCNNode!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        scnView = self.view as? SCNView
        scnView.showsStatistics = false
        scnView.allowsCameraControl = true
        scnView.autoenablesDefaultLighting = false
        
        scnScene = SCNScene()
        scnScene.background.contents = NSColor.gray
        scnView.scene = scnScene
        
        cameraNode = SCNNode()
        cameraNode.camera = SCNCamera()
        cameraNode.position = SCNVector3(x:0, y:0, z:12)
        scnScene.rootNode.addChildNode(cameraNode)
        
        let plane = SCNPlane(width: 20, height: 10)
        
        guard let shaderURL = Bundle.main.url(forResource: &#34;frag&#34;, withExtension: &#34;shader&#34;),
            let modifier = try? String(contentsOf: shaderURL)
            else { fatalError(&#34;Can&#39;t load shader from bundle.&#34;) }
        
        plane.shaderModifiers = [.fragment: modifier]
        
        let node = SCNNode(geometry: plane)
        plane.firstMaterial?.diffuse.contents = NSImage(named: &#34;skull&#34;)
        plane.firstMaterial?.diffuse.wrapS = SCNWrapMode.repeat;
        plane.firstMaterial?.diffuse.wrapT = SCNWrapMode.repeat;
        scnScene.rootNode.addChildNode(node)
        scnView.isPlaying = true
    }
}
</code></pre><p>Add a texture to the bundle, in this case it&rsquo;s called skulls and create a frag.shader file with the shader modifier.</p>
<pre tabindex="0"><code>#pragma transparent
#pragma body

float mpi = 3.1415926535897932384626433832795;
// scenekit stashes time in scn_frame
float iTime = scn_frame.time;

// grab uv coords from our material
float2 uv = _surface.diffuseTexcoord;

// we want a coords from -1 to 1 instead of standard uv coords (0-1)
float2 p = -1.0+2.0*uv;

// length and angle from center for fancy polar coord dist.
float r = length(p);
float a = atan(p.y / p.x);

//classic demo fx
float2 uvmod = float2(p.x/abs(p.y), 1/abs(p.y));
 
// uv scroll it with time
uvmod += iTime;

// get the diffuse sampler and get col at distorted uv coords
float4 texcol = u_diffuseTexture.sample(u_diffuseTextureSampler, uvmod);
_output.color.rgba = texcol;
</code></pre><p>The sample is a classic memory from my boy room. A nice u=x/abs(y) v=1/abs(y), but in 2019 I don&rsquo;t need LUTs. Nice.</p>
<p><img loading="lazy" src="/absy.gif" alt="demo time"  />
</p>
<p>The full source code can be found here <a href="https://github.com/deurell/ShaderModifierLab">https://github.com/deurell/ShaderModifierLab</a></p>
<p>&lt;3</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://deurell.github.io/tags/scenekit/">SceneKit</a></li>
      <li><a href="https://deurell.github.io/tags/shaders/">Shaders</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://deurell.github.io">Deurell Labs</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
