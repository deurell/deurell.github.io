<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Recreating Beat Saber lazers with unicorns | Deurell Labs</title>
<meta name="keywords" content="SceneKit, Shaders">
<meta name="description" content="I&rsquo;ve been coding professionally for over 20 years and I still learn new things every single day. One of the most fun and rewarding ways I use to get better is to recreate things in games I love. And I&rsquo;m in love with so many games. It never ends. An endless, lovely, gamedev tutorial!
One of the games I love is Beat Saber. I wanted to recreate it as a VR learning experience on my HTC Vive.">
<meta name="author" content="">
<link rel="canonical" href="https://deurell.github.io/posts/beatlazers/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css" integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://deurell.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://deurell.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://deurell.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://deurell.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://deurell.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Recreating Beat Saber lazers with unicorns" />
<meta property="og:description" content="I&rsquo;ve been coding professionally for over 20 years and I still learn new things every single day. One of the most fun and rewarding ways I use to get better is to recreate things in games I love. And I&rsquo;m in love with so many games. It never ends. An endless, lovely, gamedev tutorial!
One of the games I love is Beat Saber. I wanted to recreate it as a VR learning experience on my HTC Vive." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deurell.github.io/posts/beatlazers/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-14T15:56:27+02:00" />
<meta property="article:modified_time" content="2019-04-14T15:56:27+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Recreating Beat Saber lazers with unicorns"/>
<meta name="twitter:description" content="I&rsquo;ve been coding professionally for over 20 years and I still learn new things every single day. One of the most fun and rewarding ways I use to get better is to recreate things in games I love. And I&rsquo;m in love with so many games. It never ends. An endless, lovely, gamedev tutorial!
One of the games I love is Beat Saber. I wanted to recreate it as a VR learning experience on my HTC Vive."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://deurell.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Recreating Beat Saber lazers with unicorns",
      "item": "https://deurell.github.io/posts/beatlazers/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Recreating Beat Saber lazers with unicorns",
  "name": "Recreating Beat Saber lazers with unicorns",
  "description": "I\u0026rsquo;ve been coding professionally for over 20 years and I still learn new things every single day. One of the most fun and rewarding ways I use to get better is to recreate things in games I love. And I\u0026rsquo;m in love with so many games. It never ends. An endless, lovely, gamedev tutorial!\nOne of the games I love is Beat Saber. I wanted to recreate it as a VR learning experience on my HTC Vive.",
  "keywords": [
    "SceneKit", "Shaders"
  ],
  "articleBody": "I’ve been coding professionally for over 20 years and I still learn new things every single day. One of the most fun and rewarding ways I use to get better is to recreate things in games I love. And I’m in love with so many games. It never ends. An endless, lovely, gamedev tutorial!\nOne of the games I love is Beat Saber. I wanted to recreate it as a VR learning experience on my HTC Vive. It was a really fun journey. The first thing I needed to work out was to find a good way to slice geometries. That kinda sidetracked me for a while. But that’s another beautiful story including sliced unicorns, which might just be a future blog post.\nSo, after the mesh slicing was in place I needed lazers. Everyone who has played Beat Saber knows that you need cubes with some kind of lazer material. Turns out creating lazer cubes is a really nice tutorial for shader newbies. We’ll base everything on the ShaderModifier source from here. The code for this tutorial is in in the same repository but in the lazer branch.\ngit clone git@github.com:deurell/ShaderModifierLab.git git checkout lazer The only change in the ViewController setup is that we use a cube instead of a plane.\nlet geo = SCNBox(width: 6, height: 6, length: 6, chamferRadius: 1.0) After that we setup the shader to just output the UV coordinates. This is pretty much the starting point for all shader dev work, especially if we have modified the coordinate system. Outputting the UVs with X as red, Y as green and 0 as blue looks like this. You’ll remember this as a sign of “Oh nice, everything seems to be ok”.\nSceneKit calls UV’s Texcoords, just like Unreal, and it stashes them in _surface, in this case in diffureTexcoord. The shaderModifier code looks like this:\n#pragma transparent #pragma body float2 uv = _surface.diffuseTexcoord; _output.color.rgb = float3(uv.r, uv.g, 0); The first thing we have to do to turn it into a lazer is adding a fancy sine curve:\nfloat2 uv = _surface.diffuseTexcoord; float col = sin(uv.y * M_PI_F); _output.color.rgb = float3(col, col, col); We only want the first 180 degrees of the sine curve, since we have radians we’ll get values from 0-pi rad (0-180 deg). The next step will be to invert it and pow it in order to push it to the edges. We want the lazers to be concentrated to the edges of the cube. Like this:\nNow we’ll just need to do the same thing for the horizontal lazers. We also need to merge/lerp the horizontal and vertical lazers as we want lazers on all the edges on the cube. Lerp in shaders is called mix and that’s exactly what we want to do. We really want to merge them with a 0.5x+0.5y and this is exactly what mix(x,y,0.5)does.\nThe next step is to pimp the gray lazer with some green color. That’s just a multiplication with a green [red=0.2,green=0.9,blue=0.2] vector. A litte dash of whiteness look better so we multiply the final color vector with 8. And that’s it! A good enough lazer cube to slice with a light saber! The final shader code looks like this:\n#pragma transparent #pragma body float2 uv = _surface.diffuseTexcoord; // horizontal float x = 1.0-sin(uv.x*M_PI_F); x = pow(x,4) - 0.1; // vertical float y = 1.0-sin(uv.y*M_PI_F); y = pow(y,4)-0.1; // interpolate. In this case same as 0.5*x+0.5*y float mx = mix(x,y,0.5); float3 col = float3(0.2, 0.9, 0.2) * mx; col *= 8.; _output.color.rgb = col; And the final result looks like this:\n\u003c3\n",
  "wordCount" : "598",
  "inLanguage": "en",
  "datePublished": "2019-04-14T15:56:27+02:00",
  "dateModified": "2019-04-14T15:56:27+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://deurell.github.io/posts/beatlazers/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Deurell Labs",
    "logo": {
      "@type": "ImageObject",
      "url": "https://deurell.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://deurell.github.io" accesskey="h" title="Deurell Labs (Alt + H)">Deurell Labs</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Recreating Beat Saber lazers with unicorns
    </h1>
    <div class="post-meta"><span title='2019-04-14 15:56:27 +0200 CEST'>April 14, 2019</span>

</div>
  </header> 
  <div class="post-content"><p>I&rsquo;ve been coding professionally for over 20 years and I still learn new things every single day. One of the most fun and rewarding ways I use to get better is to recreate things in games I love. And I&rsquo;m in love with so many games. It never ends. An endless, lovely, gamedev tutorial!</p>
<p>One of the games I love is Beat Saber. I wanted to recreate it as a VR learning experience on my HTC Vive. It was a really fun journey. The first thing I needed to work out was to find a good way to slice geometries. That kinda sidetracked me for a while. But that&rsquo;s another beautiful story including sliced unicorns, which might just be a future blog post.</p>
<p><img loading="lazy" src="/uni.gif" alt="slicing unicorns"  />
</p>
<p>So, after the mesh slicing was in place I needed lazers. Everyone who has played Beat Saber knows that you need cubes with some kind of lazer material. Turns out creating lazer cubes is a really nice tutorial for shader newbies. We&rsquo;ll base everything on the ShaderModifier source from <a href="https://deurell.github.io/posts/scenekit-setup/">here</a>. The code for this tutorial is in in the same repository but in the <code>lazer</code> branch.</p>
<pre tabindex="0"><code>git clone git@github.com:deurell/ShaderModifierLab.git
git checkout lazer
</code></pre><p>The only change in the ViewController setup is that we use a cube instead of a plane.</p>
<pre tabindex="0"><code>let geo = SCNBox(width: 6, height: 6, length: 6, chamferRadius: 1.0)
</code></pre><p>After that we setup the shader to just output the UV coordinates. This is pretty much the starting point for all shader dev work, especially if we have modified the coordinate system. Outputting the UVs with X as red, Y as green and 0 as blue looks like this. You&rsquo;ll remember this as a sign of &ldquo;Oh nice, everything seems to be ok&rdquo;.</p>
<p><img loading="lazy" src="/uv.png" alt="uv"  />
</p>
<p>SceneKit calls UV&rsquo;s Texcoords, just like Unreal, and it stashes them in _surface, in this case in diffureTexcoord. The shaderModifier code looks like this:</p>
<pre tabindex="0"><code>#pragma transparent
#pragma body
float2 uv = _surface.diffuseTexcoord;
_output.color.rgb = float3(uv.r, uv.g, 0);
</code></pre><p>The first thing we have to do to turn it into a lazer is adding a fancy sine curve:</p>
<pre tabindex="0"><code>float2 uv = _surface.diffuseTexcoord;
float col = sin(uv.y * M_PI_F);
_output.color.rgb = float3(col, col, col);
</code></pre><p><img loading="lazy" src="/sin.png" alt="sin"  />
</p>
<p>We only want the first 180 degrees of the sine curve, since we have radians we&rsquo;ll get values from 0-pi rad (0-180 deg).
The next step will be to invert it and pow it in order to push it to the edges. We want the lazers to be concentrated to the edges of the cube. Like this:</p>
<p><img loading="lazy" src="/lazer2.png" alt="lazer"  />
</p>
<p>Now we&rsquo;ll just need to do the same thing for the horizontal lazers. We also need to merge/lerp the horizontal and vertical lazers as we want lazers on all the edges on the cube. Lerp in shaders is called <code>mix</code> and that&rsquo;s exactly what we want to do. We really want to merge them with a <code>0.5x+0.5y</code> and this is exactly what <code>mix(x,y,0.5)</code>does.</p>
<p>The next step is to pimp the gray lazer with some green color. That&rsquo;s just a multiplication with a green [red=0.2,green=0.9,blue=0.2] vector. A litte dash of whiteness look better so we multiply the final color vector with 8. And that&rsquo;s it! A good enough lazer cube to slice with a light saber! The final shader code looks like this:</p>
<pre tabindex="0"><code>#pragma transparent
#pragma body
float2 uv = _surface.diffuseTexcoord;
// horizontal
float x = 1.0-sin(uv.x*M_PI_F);
x = pow(x,4) - 0.1;
// vertical
float y = 1.0-sin(uv.y*M_PI_F);
y = pow(y,4)-0.1;
// interpolate. In this case same as 0.5*x+0.5*y 
float mx = mix(x,y,0.5);
float3 col = float3(0.2, 0.9, 0.2) * mx;
col *= 8.;
_output.color.rgb = col;
</code></pre><p>And the final result looks like this:</p>
<p><img loading="lazy" src="/lazer_res.gif" alt="lazer end result"  />
</p>
<p>&lt;3</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://deurell.github.io/tags/scenekit/">SceneKit</a></li>
      <li><a href="https://deurell.github.io/tags/shaders/">Shaders</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://deurell.github.io">Deurell Labs</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
