<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Crafting a Text-Based Adventure Game in Swift | Deurell Labs</title>



<link href="https://deurell.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Deurell Labs">

<link rel="stylesheet" href="/css/style.css">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://deurell.github.io/posts/adventure/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://deurell.github.io">
          <h1 id="nav-heading" class="title is-4">Deurell Labs</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="twitter" href='https://twitter.com/deurell'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="github" href='https://github.com/deurell'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:dev@deurell.net'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/deurell'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg>
</i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/swift/">#Swift</a>



  
  | <a class="subtitle is-6" href="/tags/c&#43;&#43;/">#C&#43;&#43;</a>
  
  | <a class="subtitle is-6" href="/tags/tutorial/">#Tutorial</a>
  


      
    </div>
    <h2 class="subtitle is-6">August 20, 2023</h2>
    <h1 class="title">Crafting a Text-Based Adventure Game in Swift</h1>
    
    <div class="content">
      <p>While working on a project, I found myself crafting a super simple text-based adventure engine. Once the core mechanics were in place, it struck me that this could double as a nice Swift tutorial. So, for those who&rsquo;ve fond memories of classics like &ldquo;Zork&rdquo; and &ldquo;Hobbit&rdquo;, join me in recreating that magic. We&rsquo;ll employ JSON to map out our game world and then use Swift to animate our adventures.</p>
<h2 id="1-our-games-blueprint-json">1. Our Game&rsquo;s Blueprint: JSON</h2>
<p>The game&rsquo;s structure is described in a structured JSON format. To create a new game we just feed the engine new JSON. It supports rooms, items, and paths:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;startingRoom&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;rooms&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;You are in a dimly lit stone chamber. The walls are cold to the touch, and the air is damp. To the north, you spot an old wooden door. In the center of the room, there&#39;s a mysterious chest that seems to have a keyhole.&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;paths&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;north&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;roomID&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;isLocked&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;items&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;chest&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A large wooden chest with intricate designs. It&#39;s locked and seems to need a key.&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;useEffects&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;silver key&#34;</span>: <span style="color:#e6db74">&#34;The chest unlocks and inside you find treasures beyond your wildest dreams!&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;You&#39;ve entered a small room. It seems like a storage chamber of sorts. Old crates and dusty shelves line the walls. Sunlight pierces through a small crack in the ceiling. On a table in the corner, you notice a shiny silver key.&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;paths&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;south&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;roomID&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;isLocked&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;items&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;silver key&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A shiny silver key with intricate engravings on it.&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;useEffects&#34;</span>: {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="2-translating-json-to-swift-structures">2. Translating JSON to Swift Structures</h2>
<p>To map our JSON to Swift, we use Codable structures:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Item</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> description: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> useEffects: [String: UseEffect]?
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">UseEffect</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> action: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> message: String
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Path</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> roomID: Int
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> isLocked: Bool
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Room</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> id: Int
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> description: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> paths: [String: Path]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> items: [Item]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="3-parsing-the-game-data-json-to-swift">3. Parsing the Game Data: JSON to Swift</h2>
<p>Leveraging Swift&rsquo;s <code>Codable</code> protocol, we can effortlessly transform JSON into Swift structures:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> decoder = JSONDecoder()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> gameData = <span style="color:#66d9ef">try</span> decoder.decode(GameData.<span style="color:#66d9ef">self</span>, from: data)
</span></span></code></pre></div><p>Here, <code>JSONDecoder</code> transforms our JSON data into the <code>GameData</code> Swift structure.</p>
<h2 id="4-interacting-with-the-game-world">4. Interacting with the Game World</h2>
<p>Our game world is alive with items to use and paths to take. Here&rsquo;s how we manage these interactions:</p>
<h3 id="picking-up-items">Picking Up Items</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">pickUpItem</span>(<span style="color:#66d9ef">_</span> itemName: String, <span style="color:#66d9ef">in</span> roomID: Int) -&gt; Bool {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    playerInventory.append(room.items[index])
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="using-items--traversing-paths">Using Items &amp; Traversing Paths</h3>
<p>Items can have various effects in the game, like unlocking doors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">useItem</span>(<span style="color:#66d9ef">_</span> itemName: String) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> useEffect.action {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;unlockDoor&#34;</span>:
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>            room.paths[direction]?.isLocked = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Unexpected action.&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This function checks if a particular item in the player&rsquo;s inventory can be used in the current room.</p>
<h2 id="5-command-parsing-logic">5. Command Parsing Logic</h2>
<p>Understanding and executing player&rsquo;s commands is the simple brain of the game. Since this is a simple engine there won&rsquo;t be a fancy command implementation. Just the code that felt fun and right when I typed it. Here&rsquo;s a look at the parsing logic:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">handleCommand</span>(<span style="color:#66d9ef">_</span> command: String) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> tokens = command.split(separator: <span style="color:#e6db74">&#34; &#34;</span>).map(String.<span style="color:#66d9ef">init</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> tokens[<span style="color:#ae81ff">0</span>] {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;look&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">guard</span> <span style="color:#66d9ef">let</span> room = gameRooms[currentRoomID] <span style="color:#66d9ef">else</span> { <span style="color:#66d9ef">return</span> }
</span></span><span style="display:flex;"><span>        lookAround(room: room)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;go&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> tokens.count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span> { print(<span style="color:#e6db74">&#34;Go where?&#34;</span>) }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            move(inDirection: tokens[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;pick&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> tokens.count <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>, tokens[<span style="color:#ae81ff">1</span>] == <span style="color:#e6db74">&#34;up&#34;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> itemName = tokens.dropFirst(<span style="color:#ae81ff">2</span>).joined(separator: <span style="color:#e6db74">&#34; &#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> pickUpItem(itemName, <span style="color:#66d9ef">in</span>: currentRoomID) {
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;You picked up the </span><span style="color:#e6db74">\(</span>itemName<span style="color:#e6db74">)</span><span style="color:#e6db74">.&#34;</span>)
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;There&#39;s no </span><span style="color:#e6db74">\(</span>itemName<span style="color:#e6db74">)</span><span style="color:#e6db74"> here.&#34;</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;use&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> tokens.count <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> itemName = tokens.dropFirst().joined(separator: <span style="color:#e6db74">&#34; &#34;</span>)
</span></span><span style="display:flex;"><span>            useItem(itemName)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;inventory&#34;</span>:
</span></span><span style="display:flex;"><span>        displayInventory()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;I don&#39;t understand.&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>By melding the principles of Swift with the nostalgia of text-based games, you&rsquo;ve created a fresh adventure. Now, armed with this foundation, you can craft even more intricate worlds and narratives. Enjoy your coding journey!</p>
<p>You can find all code for this adventure <a href="https://github.com/deurell/adventure">here</a>.</p>
<p>Oh&hellip; And since I&rsquo;ve spent a lifetime writing C++, here&rsquo;s a C++ version of the same <a href="https://github.com/deurell/simple_adventure">game</a>. It uses modern C++ in a way i like and the excellent <a href="https://github.com/nlohmann/json">nlohmann/json parser</a> for super easy JSON functionality. Always interesting to see the differences between the two implementations.</p>
<p><img src="/adventure.png" alt="Adventure"></p>

      
    </div>
    
  </div>
</section>



<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
  </div>
</section>





</body>
</html>

